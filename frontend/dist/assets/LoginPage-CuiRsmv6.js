import{u as B,a as E,b as G,r as x,j as e,B as u,C as z,I as M,T as o,A as k,e as c,f as X,D as R,g as j,h as S,i as C,k as U}from"./index-DsSW5CoL.js";import{a as w}from"./api-__jhlySV.js";import{A as N}from"./ArrowBack-D4qaOFnn.js";import{m as A}from"./proxy-BDtx62q7.js";import{C as $,a as V}from"./CardContent-TKRaw4vD.js";import{T}from"./TextField-C3_bWePu.js";import{I as O}from"./InputAdornment-CIlV7d1U.js";import{F as q,L as J}from"./Lock-DQaSB1M-.js";import{P as K}from"./Person-BoeQqeJb.js";import"./useFormControl-8Y7ZXhCe.js";const ie=()=>{const{t}=B(),f=E(),r=G(),[h,i]=x.useState(!1),[y,m]=x.useState(""),[P,b]=x.useState(!1),[p,I]=x.useState(""),[g,W]=x.useState(""),F=s=>s.replace(/\D/g,"").slice(0,12).replace(/(\d{4})(?=\d)/g,"$1 "),L=s=>{I(F(s.target.value))},v=async()=>{var s,l,n,d;i(!0),m("");try{const a=p.replace(/\s/g,"");await w.post("/auth/aadhaar/send-otp",{aadhaar:a}),b(!0),r(j({message:t("auth.otpSent"),severity:"success"}))}catch(a){m(((l=(s=a.response)==null?void 0:s.data)==null?void 0:l.error)||"Failed to send OTP"),r(j({message:((d=(n=a.response)==null?void 0:n.data)==null?void 0:d.error)||"Failed to send OTP",severity:"error"}))}finally{i(!1)}},D=async()=>{var s,l;if(g.length!==6){m("Please enter a valid 6-digit OTP");return}i(!0),r(S());try{const n=p.replace(/\s/g,""),a=(await w.post("/auth/aadhaar/verify-otp",{aadhaar:n,otp:g})).data;if(!a.success)throw new Error(a.error||"Login failed");r(C({user:{id:a.user.id,name:a.user.name,mobile:a.user.mobile||"",email:a.user.email||"",aadhaarMasked:a.user.aadhaarMasked||`XXXX-XXXX-${n.slice(-4)}`,address:a.user.address||"",connections:a.user.connections||{}},token:a.token,refreshToken:a.refreshToken,expiresIn:a.expiresIn||900})),i(!1),r(j({message:`Welcome, ${a.user.name}!`,severity:"success"})),f("/dashboard")}catch(n){i(!1);const d=((l=(s=n.response)==null?void 0:s.data)==null?void 0:l.error)||n.message||"Login failed. Please try again.";m(d),r(U(d))}},H=async()=>{i(!0),r(S()),await new Promise(s=>setTimeout(s,1e3)),r(C({user:{id:"GUEST",name:"Guest User",mobile:"",connections:{}},token:"guest-token",refreshToken:"guest-refresh",expiresIn:300,isGuest:!0})),i(!1),f("/dashboard")};return e.jsx(u,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)",py:4},children:e.jsxs(z,{maxWidth:"sm",children:[e.jsx(M,{onClick:()=>f("/"),sx:{mb:2,backgroundColor:"white",boxShadow:1},children:e.jsx(N,{})}),e.jsx(A.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(u,{sx:{textAlign:"center",mb:4},children:[e.jsx(u,{sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:80,height:80,borderRadius:"50%",background:"linear-gradient(135deg, #1a73e8 0%, #34a853 100%)",boxShadow:"0 8px 32px rgba(26, 115, 232, 0.3)",mb:2},children:e.jsx(o,{variant:"h3",sx:{color:"white",fontWeight:700},children:"S"})}),e.jsx(o,{variant:"h4",sx:{fontWeight:700,color:"primary.main"},children:"SUVIDHA"})]})}),e.jsx(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},children:e.jsx($,{elevation:4,sx:{borderRadius:4},children:e.jsxs(V,{sx:{p:4},children:[e.jsx(o,{variant:"h5",align:"center",sx:{mb:1,fontWeight:600},children:t("auth.loginTitle")}),e.jsx(o,{variant:"body2",align:"center",color:"text.secondary",sx:{mb:3},children:t("auth.loginSubtitle")}),y&&e.jsx(k,{severity:"error",sx:{mb:2},children:y}),P?e.jsxs(e.Fragment,{children:[e.jsx(k,{severity:"info",sx:{mb:3},children:t("auth.otpSent")}),e.jsx(T,{fullWidth:!0,label:t("auth.enterOtp"),value:g,onChange:s=>W(s.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"------",InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(J,{color:"primary"})})},sx:{mb:2}}),e.jsxs(u,{sx:{display:"flex",gap:2},children:[e.jsx(c,{variant:"outlined",onClick:()=>b(!1),sx:{flex:1,minHeight:48},children:t("common.back")}),e.jsx(c,{variant:"contained",onClick:D,disabled:g.length!==6||h,sx:{flex:2,minHeight:48},children:h?e.jsx(X,{size:24}):t("auth.verifyOtp")})]}),e.jsx(c,{fullWidth:!0,variant:"text",sx:{mt:2},onClick:v,children:t("auth.resendOtp")})]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{fullWidth:!0,label:t("auth.enterAadhaar"),value:p,onChange:L,placeholder:"XXXX XXXX XXXX",InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(q,{color:"primary"})})},sx:{mb:3}}),e.jsx(c,{fullWidth:!0,variant:"contained",size:"large",onClick:v,disabled:p.replace(/\s/g,"").length!==12||h,sx:{minHeight:56},children:h?e.jsx(X,{size:24}):"Send OTP"})]}),e.jsx(R,{sx:{my:3},children:e.jsx(o,{variant:"body2",color:"text.secondary",children:"OR"})}),e.jsx(c,{fullWidth:!0,variant:"outlined",size:"large",startIcon:e.jsx(K,{}),onClick:H,disabled:h,sx:{minHeight:56},children:t("auth.guestMode")}),e.jsx(o,{variant:"caption",display:"block",textAlign:"center",color:"text.secondary",sx:{mt:2},children:"Guest mode has limited access. Session expires in 5 minutes."})]})})}),e.jsx(u,{sx:{textAlign:"center",mt:3},children:e.jsxs(o,{variant:"body2",color:"text.secondary",children:[t("auth.newUser")," ",e.jsx(c,{variant:"text",sx:{textTransform:"none"},children:t("auth.registerNow")})]})})]})})};export{ie as default};
//# sourceMappingURL=LoginPage-CuiRsmv6.js.map
