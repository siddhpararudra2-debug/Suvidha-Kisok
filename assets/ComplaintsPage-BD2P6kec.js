import{m as V,n as Y,r as n,o as J,j as e,p as E,q as _,t as M,Z as L,v as z,c as he,u as ye,b as ve,E as fe,L as je,W as be,B as g,y as T,T as o,e as W,d as F,f as ee,A as G,I as Ie,g as S,_ as we}from"./index-CJ6MaM8b.js";import{a as Ce}from"./api-Pfy0Ae3B.js";import{C as Se}from"./Check-BcMR-27H.js";import{G as j}from"./Grid2-DVxtt1Zo.js";import{C as U,a as H}from"./CardContent-D-MrYNNE.js";import{S as Le,a as Re,b as Pe}from"./Stepper-DczYie2k.js";import{M as We}from"./MyLocation-R_Tmh9_L.js";import{T as te}from"./TextField-Dxn9Ud9w.js";import{R as Me,a as B}from"./RadioGroup-C5K6UYru.js";import{F as k}from"./FormControlLabel--P5DCPPy.js";import{U as Ae}from"./Upload-24Yps2jZ.js";import{i as Be}from"./isMuiElement-CUTupkmi.js";import{D as ke}from"./Delete-Bfwb6b8f.js";import{S as Ee}from"./Schedule-R_830TTt.js";import{P as ze}from"./Person-BBEOXa6S.js";import"./useFormControl-RHgvjy84.js";import"./FormGroup-CQIjepjd.js";function Ne(s){return V("MuiImageList",s)}Y("MuiImageList",["root","masonry","quilted","standard","woven"]);const se=n.createContext({}),$e=s=>{const{classes:i,variant:r}=s;return _({root:["root",r]},Ne,i)},De=M("ul",{name:"MuiImageList",slot:"Root",overridesResolver:(s,i)=>{const{ownerState:r}=s;return[i.root,i[r.variant]]}})({display:"grid",overflowY:"auto",listStyle:"none",padding:0,WebkitOverflowScrolling:"touch",variants:[{props:{variant:"masonry"},style:{display:"block"}}]}),Te=n.forwardRef(function(i,r){const a=J({props:i,name:"MuiImageList"}),{children:x,className:m,cols:b=2,component:d="ul",rowHeight:h="auto",gap:l=4,style:R,variant:c="standard",...y}=a,v=n.useMemo(()=>({rowHeight:h,gap:l,variant:c}),[h,l,c]),I=c==="masonry"?{columnCount:b,columnGap:l,...R}:{gridTemplateColumns:`repeat(${b}, 1fr)`,gap:l,...R},u={...a,component:d,gap:l,rowHeight:h,variant:c},w=$e(u);return e.jsx(De,{as:d,className:E(w.root,w[c],m),ref:r,style:I,ownerState:u,...y,children:e.jsx(se.Provider,{value:v,children:x})})});function Fe(s){return V("MuiImageListItem",s)}const O=Y("MuiImageListItem",["root","img","standard","woven","masonry","quilted"]),Ge=s=>{const{classes:i,variant:r}=s;return _({root:["root",r],img:["img"]},Fe,i)},Ue=M("li",{name:"MuiImageListItem",slot:"Root",overridesResolver:(s,i)=>{const{ownerState:r}=s;return[{[`& .${O.img}`]:i.img},i.root,i[r.variant]]}})({display:"block",position:"relative",[`& .${O.img}`]:{objectFit:"cover",width:"100%",height:"100%",display:"block"},variants:[{props:{variant:"standard"},style:{display:"flex",flexDirection:"column"}},{props:{variant:"woven"},style:{height:"100%",alignSelf:"center","&:nth-of-type(even)":{height:"70%"}}},{props:{variant:"standard"},style:{[`& .${O.img}`]:{height:"auto",flexGrow:1}}}]}),He=n.forwardRef(function(i,r){const a=J({props:i,name:"MuiImageListItem"}),{children:x,className:m,cols:b=1,component:d="li",rows:h=1,style:l,...R}=a,{rowHeight:c="auto",gap:y,variant:v}=n.useContext(se);let I="auto";v==="woven"?I=void 0:c!=="auto"&&(I=c*h+y*(h-1));const u={...a,cols:b,component:d,gap:y,rowHeight:c,rows:h,variant:v},w=Ge(u);return e.jsx(Ue,{as:d,className:E(w.root,w[v],m),ref:r,style:{height:I,gridColumnEnd:v!=="masonry"?`span ${b}`:void 0,gridRowEnd:v!=="masonry"?`span ${h}`:void 0,marginBottom:v==="masonry"?y:void 0,breakInside:v==="masonry"?"avoid":void 0,...l},ownerState:u,...R,children:n.Children.map(x,p=>n.isValidElement(p)?p.type==="img"||Be(p,["Image"])?n.cloneElement(p,{className:E(w.img,p.props.className)}):p:null)})});function Oe(s){return V("MuiImageListItemBar",s)}Y("MuiImageListItemBar",["root","positionBottom","positionTop","positionBelow","actionPositionLeft","actionPositionRight","titleWrap","titleWrapBottom","titleWrapTop","titleWrapBelow","titleWrapActionPosLeft","titleWrapActionPosRight","title","subtitle","actionIcon","actionIconActionPosLeft","actionIconActionPosRight"]);const Ve=s=>{const{classes:i,position:r,actionIcon:a,actionPosition:x}=s,m={root:["root",`position${L(r)}`,`actionPosition${L(x)}`],titleWrap:["titleWrap",`titleWrap${L(r)}`,a&&`titleWrapActionPos${L(x)}`],title:["title"],subtitle:["subtitle"],actionIcon:["actionIcon",`actionIconActionPos${L(x)}`]};return _(m,Oe,i)},Ye=M("div",{name:"MuiImageListItemBar",slot:"Root",overridesResolver:(s,i)=>{const{ownerState:r}=s;return[i.root,i[`position${L(r.position)}`]]}})(z(({theme:s})=>({position:"absolute",left:0,right:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",fontFamily:s.typography.fontFamily,variants:[{props:{position:"bottom"},style:{bottom:0}},{props:{position:"top"},style:{top:0}},{props:{position:"below"},style:{position:"relative",background:"transparent",alignItems:"normal"}}]}))),Je=M("div",{name:"MuiImageListItemBar",slot:"TitleWrap",overridesResolver:(s,i)=>{const{ownerState:r}=s;return[i.titleWrap,i[`titleWrap${L(r.position)}`],r.actionIcon&&i[`titleWrapActionPos${L(r.actionPosition)}`]]}})(z(({theme:s})=>({flexGrow:1,padding:"12px 16px",color:(s.vars||s).palette.common.white,overflow:"hidden",variants:[{props:{position:"below"},style:{padding:"6px 0 12px",color:"inherit"}},{props:({ownerState:i})=>i.actionIcon&&i.actionPosition==="left",style:{paddingLeft:0}},{props:({ownerState:i})=>i.actionIcon&&i.actionPosition==="right",style:{paddingRight:0}}]}))),_e=M("div",{name:"MuiImageListItemBar",slot:"Title",overridesResolver:(s,i)=>i.title})(z(({theme:s})=>({fontSize:s.typography.pxToRem(16),lineHeight:"24px",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}))),qe=M("div",{name:"MuiImageListItemBar",slot:"Subtitle",overridesResolver:(s,i)=>i.subtitle})(z(({theme:s})=>({fontSize:s.typography.pxToRem(12),lineHeight:1,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}))),Ke=M("div",{name:"MuiImageListItemBar",slot:"ActionIcon",overridesResolver:(s,i)=>{const{ownerState:r}=s;return[i.actionIcon,i[`actionIconActionPos${L(r.actionPosition)}`]]}})({variants:[{props:{actionPosition:"left"},style:{order:-1}}]}),Qe=n.forwardRef(function(i,r){const a=J({props:i,name:"MuiImageListItemBar"}),{actionIcon:x,actionPosition:m="right",className:b,subtitle:d,title:h,position:l="bottom",...R}=a,c={...a,position:l,actionPosition:m},y=Ve(c);return e.jsxs(Ye,{ownerState:c,className:E(y.root,b),ref:r,...R,children:[e.jsxs(Je,{ownerState:c,className:y.titleWrap,children:[e.jsx(_e,{className:y.title,children:h}),d?e.jsx(qe,{className:y.subtitle,children:d}):null]}),x?e.jsx(Ke,{ownerState:c,className:y.actionIcon,children:x}):null]})}),Ze=he(e.jsx("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-8 12.5v-9l6 4.5z"}),"VideoLibrary"),ht=()=>{var Z;const{t:s}=ye(),i=ve(),r=n.useRef(null),[a,x]=n.useState(0),[m,b]=n.useState(""),[d,h]=n.useState(""),[l,R]=n.useState("medium"),[c,y]=n.useState(""),[v,I]=n.useState(""),[u,w]=n.useState(null),[p,N]=n.useState([]),[q,$]=n.useState(!1),[D,A]=n.useState(!1),[ie,K]=n.useState(!1),[oe,re]=n.useState(""),ae=[s("complaints.selectCategory"),"Location & Details",s("complaints.uploadPhotos"),"Review & Submit"],Q=[{id:"electricity",icon:e.jsx(fe,{}),label:s("services.electricity"),color:"#fbbc04",subcategories:["Power Outage","Voltage Fluctuation","Meter Problem","Street Light Issue","Billing Dispute","Illegal Connection","Transformer Issue"]},{id:"gas",icon:e.jsx(je,{}),label:s("services.gas"),color:"#ea4335",subcategories:["Gas Leak (EMERGENCY)","Low Pressure","Meter Issue","Billing Dispute","PNG Connection Problem","Pipeline Damage"]},{id:"water",icon:e.jsx(be,{}),label:s("services.water"),color:"#1a73e8",subcategories:["No Water Supply","Low Pressure","Water Quality Issue","Pipeline Leakage","Sewage Overflow","Meter Problem","Billing Dispute"]}],ne=[{id:"CMP-2026-001",category:"electricity",subcategory:"Power Outage",status:"in_progress",createdAt:"25 Jan 2026",estimatedResolution:"28 Jan 2026",officer:{name:"Rajesh Kumar",designation:"Junior Engineer",phone:"+91 22 1234 5678"}},{id:"CMP-2026-002",category:"water",subcategory:"Low Pressure",status:"resolved",createdAt:"20 Jan 2026",resolvedAt:"23 Jan 2026"}],le=t=>{switch(t){case"registered":return"info";case"assigned":return"secondary";case"in_progress":return"warning";case"resolved":return"success";default:return"default"}},ce=()=>{A(!0),"geolocation"in navigator?navigator.geolocation.getCurrentPosition(async t=>{const{latitude:f,longitude:C}=t.coords;w({lat:f,lng:C}),I(`Near coordinates: ${f.toFixed(4)}, ${C.toFixed(4)}`),A(!1),i(S({message:"Location captured successfully",severity:"success"}))},()=>{A(!1),i(S({message:"Could not get location",severity:"error"}))},{enableHighAccuracy:!0,timeout:1e4}):(A(!1),i(S({message:"Geolocation not supported",severity:"error"})))},de=t=>{const f=t.target.files;if(!f)return;const C=[];Array.from(f).forEach(P=>{if(p.length+C.length>=5){i(S({message:"Maximum 5 files allowed",severity:"warning"}));return}if(P.size>10*1024*1024){i(S({message:`${P.name} is too large (max 10MB)`,severity:"error"}));return}const X=P.type.startsWith("image/"),ge=P.type.startsWith("video/");if(!X&&!ge){i(S({message:"Only images and videos allowed",severity:"error"}));return}const xe=URL.createObjectURL(P);C.push({file:P,preview:xe,type:X?"image":"video"})}),N([...p,...C])},me=t=>{const f=[...p];URL.revokeObjectURL(f[t].preview),f.splice(t,1),N(f)},ue=async()=>{$(!0);try{const t={type:m,category:d,subcategory:d,description:c,address:v||"Surat, Gujarat",latitude:(u==null?void 0:u.lat)||21.1702,longitude:(u==null?void 0:u.lng)||72.8311,priority:l==="emergency"?"critical":l},C=(await Ce.post("/complaints",t)).data.id||`CMP-2026-${String(Math.floor(Math.random()*900)+100)}`;re(C),i(we({id:C,type:m,category:d,subcategory:d,description:c,location:u?{...u,address:v}:{lat:21.1702,lng:72.8311,address:"Surat, Gujarat"},priority:l,status:"registered",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),attachments:p.map(P=>P.file.name),updates:[{timestamp:new Date().toISOString(),status:"registered",message:"Complaint registered successfully",by:"System"}]})),$(!1),K(!0),i(S({message:"Complaint submitted successfully!",severity:"success"}))}catch(t){console.error("Failed to submit complaint:",t),$(!1),i(S({message:"Failed to submit complaint. Please try again.",severity:"error"}))}},pe=t=>{i(S({message:`Complaint ${t} escalated to senior officer`,severity:"success"}))};return ie?e.jsxs(g,{children:[e.jsxs(T,{elevation:0,sx:{p:4,textAlign:"center",background:"linear-gradient(135deg, #34a853 0%, #1e8e3e 100%)",borderRadius:3,color:"white"},children:[e.jsx(Se,{sx:{fontSize:64,mb:2}}),e.jsx(o,{variant:"h4",sx:{fontWeight:700,mb:2},children:"Complaint Registered Successfully!"}),e.jsxs(o,{variant:"h5",sx:{mb:1},children:[s("complaints.complaintNumber"),": ",e.jsx("strong",{children:oe})]}),e.jsx(o,{variant:"body1",sx:{opacity:.9,mb:3},children:"You will receive SMS updates on your registered mobile number"}),e.jsxs(o,{variant:"body2",children:[s("complaints.estimatedResolution"),": 48 hours"]})]}),e.jsxs(g,{sx:{mt:4,display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(W,{variant:"contained",onClick:()=>{K(!1),x(0),b(""),h(""),y(""),I(""),w(null),N([])},children:"Register Another Complaint"}),e.jsx(W,{variant:"outlined",onClick:()=>window.location.reload(),children:"View My Complaints"})]})]}):e.jsxs(g,{children:[e.jsxs(T,{elevation:0,sx:{p:3,mb:4,background:"linear-gradient(135deg, #e37400 0%, #ff9800 100%)",borderRadius:3,color:"white"},children:[e.jsx(o,{variant:"h4",sx:{fontWeight:700,mb:1},children:s("complaints.title")}),e.jsx(o,{variant:"body1",sx:{opacity:.9},children:"Register new complaints and track existing ones"})]}),e.jsxs(j,{container:!0,spacing:4,children:[e.jsx(j,{size:{xs:12,md:7},children:e.jsx(U,{sx:{borderRadius:3},children:e.jsxs(H,{children:[e.jsx(o,{variant:"h6",sx:{mb:3,fontWeight:600},children:"Register New Complaint"}),e.jsx(Le,{activeStep:a,sx:{mb:4},alternativeLabel:!0,children:ae.map(t=>e.jsx(Re,{children:e.jsx(Pe,{children:t})},t))}),a===0&&e.jsxs(g,{children:[e.jsx(o,{variant:"subtitle2",sx:{mb:2,fontWeight:600},children:"Select Service Type"}),e.jsx(j,{container:!0,spacing:2,sx:{mb:3},children:Q.map(t=>e.jsx(j,{size:{xs:4},children:e.jsx(U,{variant:m===t.id?"elevation":"outlined",sx:{cursor:"pointer",borderColor:m===t.id?t.color:"divider",borderWidth:m===t.id?2:1,transition:"all 0.2s","&:hover":{transform:"scale(1.02)"}},onClick:()=>{b(t.id),h("")},children:e.jsxs(H,{sx:{textAlign:"center",py:3},children:[e.jsx(g,{sx:{color:t.color,mb:1},children:t.icon}),e.jsx(o,{variant:"body2",sx:{fontWeight:600},children:t.label})]})})},t.id))}),m&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"subtitle2",sx:{mb:2,fontWeight:600},children:"Select Issue Type"}),e.jsx(g,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:(Z=Q.find(t=>t.id===m))==null?void 0:Z.subcategories.map(t=>e.jsx(F,{label:t,onClick:()=>h(t),color:d===t?"primary":"default",variant:d===t?"filled":"outlined",sx:{cursor:"pointer",fontSize:t.includes("EMERGENCY")?14:13,color:t.includes("EMERGENCY")&&d!==t?"error.main":void 0,borderColor:t.includes("EMERGENCY")?"error.main":void 0}},t))})]})]}),a===1&&e.jsxs(g,{children:[e.jsx(W,{variant:"outlined",startIcon:D?e.jsx(ee,{size:20}):e.jsx(We,{}),fullWidth:!0,onClick:ce,disabled:D,sx:{mb:2,minHeight:56},children:D?"Getting Location...":s("complaints.autoDetect")}),u&&e.jsxs(G,{severity:"success",sx:{mb:2},children:["Location captured: ",u.lat.toFixed(4),", ",u.lng.toFixed(4)]}),e.jsx(te,{fullWidth:!0,label:"Address / Landmark",placeholder:"Enter your address or nearby landmark",value:v,onChange:t=>I(t.target.value),sx:{mb:3}}),e.jsx(te,{fullWidth:!0,label:s("complaints.describeIssue"),multiline:!0,rows:4,value:c,onChange:t=>y(t.target.value),placeholder:"Describe your issue in detail...",sx:{mb:3}}),e.jsx(o,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:s("complaints.priority")}),e.jsxs(Me,{row:!0,value:l,onChange:t=>R(t.target.value),children:[e.jsx(k,{value:"low",control:e.jsx(B,{}),label:s("complaints.low")}),e.jsx(k,{value:"medium",control:e.jsx(B,{}),label:s("complaints.medium")}),e.jsx(k,{value:"high",control:e.jsx(B,{color:"error"}),label:s("complaints.high")}),e.jsx(k,{value:"emergency",control:e.jsx(B,{color:"error"}),label:s("complaints.emergency")})]})]}),a===2&&e.jsxs(g,{children:[e.jsx("input",{type:"file",ref:r,onChange:de,accept:"image/*,video/*",multiple:!0,style:{display:"none"}}),e.jsx(W,{variant:"outlined",startIcon:e.jsx(Ae,{}),fullWidth:!0,onClick:()=>{var t;return(t=r.current)==null?void 0:t.click()},sx:{mb:3,minHeight:80,borderStyle:"dashed"},children:e.jsxs(g,{sx:{textAlign:"center"},children:[e.jsx(o,{children:s("complaints.uploadPhotos")}),e.jsx(o,{variant:"caption",color:"text.secondary",children:"Max 5 files, 10MB each (Images or Videos)"})]})}),p.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(o,{variant:"subtitle2",sx:{mb:2},children:["Uploaded Files (",p.length,"/5)"]}),e.jsx(Te,{cols:3,rowHeight:120,gap:8,children:p.map((t,f)=>e.jsxs(He,{children:[t.type==="image"?e.jsx("img",{src:t.preview,alt:`Attachment ${f+1}`,style:{height:120,objectFit:"cover",borderRadius:8}}):e.jsx(g,{sx:{height:120,bgcolor:"grey.200",borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ze,{sx:{fontSize:40,color:"grey.500"}})}),e.jsx(Qe,{subtitle:t.file.name.slice(0,15)+"...",actionIcon:e.jsx(Ie,{sx:{color:"white"},onClick:()=>me(f),children:e.jsx(ke,{})})})]},f))})]}),e.jsx(G,{severity:"info",sx:{mt:2},children:"Photos/videos help us understand and resolve your issue faster"})]}),a===3&&e.jsxs(g,{children:[e.jsx(T,{variant:"outlined",sx:{p:2,mb:3,borderRadius:2},children:e.jsxs(j,{container:!0,spacing:2,children:[e.jsxs(j,{size:{xs:6},children:[e.jsx(o,{variant:"caption",color:"text.secondary",children:"Category"}),e.jsx(o,{variant:"body1",sx:{fontWeight:500},children:m})]}),e.jsxs(j,{size:{xs:6},children:[e.jsx(o,{variant:"caption",color:"text.secondary",children:"Issue Type"}),e.jsx(o,{variant:"body1",sx:{fontWeight:500},children:d})]}),e.jsxs(j,{size:{xs:6},children:[e.jsx(o,{variant:"caption",color:"text.secondary",children:"Priority"}),e.jsx(F,{label:l,size:"small",color:l==="high"||l==="emergency"?"error":l==="medium"?"warning":"default"})]}),e.jsxs(j,{size:{xs:6},children:[e.jsx(o,{variant:"caption",color:"text.secondary",children:"Attachments"}),e.jsxs(o,{variant:"body1",children:[p.length," files"]})]}),e.jsxs(j,{size:{xs:12},children:[e.jsx(o,{variant:"caption",color:"text.secondary",children:"Location"}),e.jsx(o,{variant:"body2",children:v||"Not provided"})]}),e.jsxs(j,{size:{xs:12},children:[e.jsx(o,{variant:"caption",color:"text.secondary",children:"Description"}),e.jsx(o,{variant:"body2",children:c})]})]})}),e.jsxs(G,{severity:"info",children:["Expected resolution time: ",l==="emergency"?"4 hours":l==="high"?"24 hours":"48 hours"]})]}),e.jsxs(g,{sx:{display:"flex",gap:2,mt:4},children:[e.jsx(W,{variant:"outlined",disabled:a===0,onClick:()=>x(t=>t-1),sx:{flex:1,minHeight:48},children:s("common.back")}),e.jsx(W,{variant:"contained",onClick:()=>{a===3?ue():x(t=>t+1)},disabled:a===0&&(!m||!d)||a===1&&!c||q,sx:{flex:2,minHeight:48},children:q?e.jsx(ee,{size:24}):s(a===3?"complaints.submitComplaint":"common.next")})]})]})})}),e.jsxs(j,{size:{xs:12,md:5},children:[e.jsx(o,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Your Complaints"}),ne.map(t=>e.jsx(U,{sx:{mb:2,borderRadius:2},children:e.jsxs(H,{children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(o,{variant:"subtitle2",sx:{fontWeight:600},children:t.id}),e.jsx(F,{label:s(`complaints.status.${t.status}`),size:"small",color:le(t.status)})]}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:1},children:t.subcategory}),e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(Ee,{sx:{fontSize:16,color:"text.secondary"}}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:["Created: ",t.createdAt]})]}),t.officer&&e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(ze,{sx:{fontSize:16,color:"text.secondary"}}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:["Assigned to: ",t.officer.name]})]}),t.status==="in_progress"&&e.jsx(W,{variant:"outlined",color:"warning",size:"small",fullWidth:!0,onClick:()=>pe(t.id),sx:{mt:1},children:"Escalate to Senior Officer"})]})},t.id))]})]})]})};export{ht as default};
//# sourceMappingURL=ComplaintsPage-BD2P6kec.js.map
